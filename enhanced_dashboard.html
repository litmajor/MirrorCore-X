
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MirrorCore-X Enhanced Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        .card {
            background: rgba(30, 41, 59, 0.8);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .metric-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #10b981; box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
        .status-offline { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        }
        
        .trading-chart {
            height: 400px;
            width: 100%;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center">
                <div>
                    <h1 class="text-4xl font-bold gradient-text mb-2">MirrorCore-X Enhanced Dashboard</h1>
                    <p class="text-slate-400">Advanced Multi-Agent Cognitive Trading System</p>
                </div>
                <div class="flex items-center space-x-4 mt-4 lg:mt-0">
                    <div class="flex items-center">
                        <span id="status-indicator" class="status-indicator status-offline"></span>
                        <span id="connection-status">Disconnected</span>
                    </div>
                    <div id="tick-counter" class="text-lg font-mono bg-slate-800 px-4 py-2 rounded-lg border border-slate-600">
                        Tick #0
                    </div>
                    <button id="start-btn" class="btn btn-primary">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                        </svg>
                        Start System
                    </button>
                    <button id="stop-btn" class="btn btn-danger">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path>
                        </svg>
                        Stop System
                    </button>
                </div>
            </div>
        </header>

        <!-- System Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="card metric-card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-slate-400 mb-1">Total P&L</p>
                        <p id="total-pnl" class="text-2xl font-bold text-green-400">$0.00</p>
                    </div>
                    <div class="text-3xl text-green-400">ðŸ’°</div>
                </div>
            </div>
            
            <div class="card metric-card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-slate-400 mb-1">Win Rate</p>
                        <p id="win-rate" class="text-2xl font-bold text-blue-400">0%</p>
                    </div>
                    <div class="text-3xl text-blue-400">ðŸŽ¯</div>
                </div>
            </div>
            
            <div class="card metric-card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-slate-400 mb-1">Active Signals</p>
                        <p id="active-signals" class="text-2xl font-bold text-purple-400">0</p>
                    </div>
                    <div class="text-3xl text-purple-400">ðŸ“¡</div>
                </div>
            </div>
            
            <div class="card metric-card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-slate-400 mb-1">System Health</p>
                        <p id="system-health" class="text-2xl font-bold text-emerald-400">100%</p>
                    </div>
                    <div class="text-3xl text-emerald-400">ðŸ’š</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Trading Chart -->
            <div class="lg:col-span-2 card p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Real-time Trading Chart</h2>
                <div id="trading-chart" class="trading-chart"></div>
            </div>
            
            <!-- Strategy Performance -->
            <div class="card p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Strategy Performance</h2>
                <div id="strategy-list" class="space-y-3">
                    <!-- Dynamic strategy cards will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Additional Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
            <!-- Recent Trades -->
            <div class="card p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">Recent Trades</h2>
                <div id="recent-trades" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- Trade entries will be inserted here -->
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="card p-6">
                <h2 class="text-xl font-semibold mb-4 text-white">System Activity</h2>
                <div id="system-logs" class="space-y-2 max-h-96 overflow-y-auto font-mono text-sm">
                    <!-- Log entries will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let socket;
        let tradingChart;
        let chartSeries;
        let systemRunning = false;

        // Initialize WebSocket connection
        function initializeWebSocket() {
            socket = io();
            
            socket.on('connect', function() {
                updateConnectionStatus('Connected', 'online');
                addLog('Connected to MirrorCore-X system', 'success');
            });
            
            socket.on('disconnect', function() {
                updateConnectionStatus('Disconnected', 'offline');
                addLog('Disconnected from system', 'error');
            });
            
            socket.on('dashboard_update', function(data) {
                updateDashboard(data);
            });
            
            socket.on('system_status', function(data) {
                handleSystemStatus(data);
            });
            
            socket.on('strategy_performance', function(data) {
                updateStrategyPerformance(data);
            });
        }

        // Initialize trading chart
        function initializeTradingChart() {
            const chartContainer = document.getElementById('trading-chart');
            tradingChart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 400,
                layout: {
                    backgroundColor: 'transparent',
                    textColor: '#e2e8f0',
                },
                grid: {
                    vertLines: { color: 'rgba(148, 163, 184, 0.1)' },
                    horzLines: { color: 'rgba(148, 163, 184, 0.1)' },
                },
                rightPriceScale: {
                    borderColor: 'rgba(148, 163, 184, 0.2)',
                },
                timeScale: {
                    borderColor: 'rgba(148, 163, 184, 0.2)',
                    timeVisible: true,
                    secondsVisible: true,
                },
            });

            chartSeries = tradingChart.addLineSeries({
                color: '#3b82f6',
                lineWidth: 2,
            });
        }

        // Update connection status
        function updateConnectionStatus(status, type) {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('connection-status');
            
            indicator.className = `status-indicator status-${type}`;
            statusText.textContent = status;
        }

        // Update dashboard with new data
        function updateDashboard(data) {
            // Update tick counter
            document.getElementById('tick-counter').textContent = `Tick #${data.tick_count || 0}`;
            
            // Update metrics
            if (data.system_performance) {
                document.getElementById('total-pnl').textContent = `$${(data.system_performance.pnl || 0).toFixed(2)}`;
                document.getElementById('win-rate').textContent = `${(data.system_performance.win_rate || 0).toFixed(1)}%`;
            }
            
            // Update chart
            if (data.market_data && data.market_data.length > 0) {
                const latestData = data.market_data[data.market_data.length - 1];
                if (latestData && latestData.price) {
                    chartSeries.update({
                        time: Math.floor(Date.now() / 1000),
                        value: latestData.price
                    });
                }
            }
            
            // Update active signals
            if (data.scanner_data) {
                document.getElementById('active-signals').textContent = data.scanner_data.length || 0;
            }
            
            // Update recent trades
            if (data.trades) {
                updateRecentTrades(data.trades);
            }
            
            // Update strategy grades
            if (data.strategy_grades) {
                updateStrategyGrades(data.strategy_grades);
            }
        }

        // Update recent trades display
        function updateRecentTrades(trades) {
            const container = document.getElementById('recent-trades');
            if (!trades || trades.length === 0) {
                container.innerHTML = '<p class="text-slate-400">No recent trades</p>';
                return;
            }
            
            const recentTrades = trades.slice(-10).reverse();
            container.innerHTML = recentTrades.map(trade => `
                <div class="flex justify-between items-center p-3 rounded-lg ${trade.pnl > 0 ? 'bg-green-500/10 border border-green-500/20' : 'bg-red-500/10 border border-red-500/20'}">
                    <div>
                        <span class="font-semibold">${trade.symbol}</span>
                        <span class="text-sm text-slate-400 ml-2">${trade.strategy}</span>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold ${trade.pnl > 0 ? 'text-green-400' : 'text-red-400'}">
                            ${trade.pnl > 0 ? '+' : ''}$${trade.pnl.toFixed(2)}
                        </div>
                        <div class="text-xs text-slate-400">
                            ${new Date(trade.timestamp * 1000).toLocaleTimeString()}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update strategy grades
        function updateStrategyGrades(grades) {
            const container = document.getElementById('strategy-list');
            if (!grades || Object.keys(grades).length === 0) {
                container.innerHTML = '<p class="text-slate-400">No strategy data available</p>';
                return;
            }
            
            container.innerHTML = Object.entries(grades).map(([name, data]) => `
                <div class="p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">${name}</span>
                        <span class="text-sm font-mono bg-slate-700 px-2 py-1 rounded">
                            Weight: ${(data.weight || 0).toFixed(3)}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-slate-400">Win Rate:</span>
                            <span class="ml-1 ${data.win_rate > 0.5 ? 'text-green-400' : 'text-red-400'}">
                                ${(data.win_rate * 100 || 0).toFixed(1)}%
                            </span>
                        </div>
                        <div>
                            <span class="text-slate-400">Total P&L:</span>
                            <span class="ml-1 ${data.total_pnl > 0 ? 'text-green-400' : 'text-red-400'}">
                                $${(data.total_pnl || 0).toFixed(2)}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Handle system status updates
        function handleSystemStatus(data) {
            addLog(`System status: ${data.message}`, data.status === 'error' ? 'error' : 'info');
            
            if (data.status === 'starting') {
                systemRunning = true;
                document.getElementById('start-btn').disabled = true;
                document.getElementById('stop-btn').disabled = false;
            } else if (data.status === 'stopped') {
                systemRunning = false;
                document.getElementById('start-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
            }
        }

        // Add log entry
        function addLog(message, type = 'info') {
            const container = document.getElementById('system-logs');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-slate-300';
            
            const logEntry = document.createElement('div');
            logEntry.className = `${colorClass} text-sm`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            container.insertBefore(logEntry, container.firstChild);
            
            // Keep only last 50 log entries
            while (container.children.length > 50) {
                container.removeChild(container.lastChild);
            }
        }

        // Event listeners
        document.getElementById('start-btn').addEventListener('click', function() {
            socket.emit('start_system');
        });

        document.getElementById('stop-btn').addEventListener('click', function() {
            socket.emit('stop_system');
        });

        // Initialize everything when page loads
        window.addEventListener('load', function() {
            initializeWebSocket();
            initializeTradingChart();
            addLog('Dashboard initialized', 'success');
            
            // Request initial strategy performance data
            setTimeout(() => {
                if (socket) {
                    socket.emit('get_strategy_performance');
                }
            }, 1000);
        });

        // Handle window resize for chart
        window.addEventListener('resize', function() {
            if (tradingChart) {
                tradingChart.applyOptions({
                    width: document.getElementById('trading-chart').clientWidth
                });
            }
        });
    </script>
</body>
</html>
